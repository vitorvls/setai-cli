# Reglas de Pruebas

## Objetivo
Este archivo define la estrategia de pruebas y reglas obligatorias para garantizar calidad del c√≥digo.

## Alcance
- Estrategia de pruebas
- Tipos de pruebas obligatorios
- Cobertura m√≠nima
- Patrones de escritura de pruebas

---

## Estrategia de Pruebas

{{#if TEST_STRATEGY}}
### Estrategia de Pruebas Personalizada

{{TEST_STRATEGY}}

---
{{/if}}
### TDD (Test-Driven Development) - OBLIGATORIO

**CR√çTICO: Pruebas ANTES del c√≥digo**

Este proyecto utiliza **TDD (Test-Driven Development)** como metodolog√≠a obligatoria. Las pruebas deben escribirse **ANTES** de la implementaci√≥n del c√≥digo.

#### Ciclo TDD (Red-Green-Refactor)

1. **üî¥ RED (Rojo):** Escribir una prueba que falla
   - La prueba debe describir el comportamiento deseado
   - La prueba debe fallar porque la funcionalidad a√∫n no existe

2. **üü¢ GREEN (Verde):** Escribir c√≥digo m√≠nimo para hacer pasar la prueba
   - Implementar solo lo necesario para que la prueba pase
   - No optimizar o agregar features extras a√∫n

3. **üîµ REFACTOR (Refactorizar):** Mejorar el c√≥digo manteniendo las pruebas verdes
   - Mejorar estructura, legibilidad, rendimiento
   - Garantizar que todas las pruebas contin√∫an pasando

#### Reglas TDD Obligatorias

- **NUNCA escribir c√≥digo sin prueba primero**
- **NUNCA commitear c√≥digo sin prueba correspondiente**
- **SIEMPRE escribir la prueba antes de la implementaci√≥n**
- **SIEMPRE hacer pasar la prueba antes de refactorizar**
- **SIEMPRE refactorizar manteniendo las pruebas verdes**

#### Flujo de Desarrollo con TDD

```
1. Escribir prueba (debe fallar) ‚Üí RED
2. Implementar c√≥digo m√≠nimo ‚Üí GREEN
3. Refactorizar si es necesario ‚Üí REFACTOR
4. Repetir para pr√≥xima funcionalidad
```

#### Excepciones (Muy Raras)

Solo en casos excepcionales, con aprobaci√≥n expl√≠cita:
- Prototipado r√°pido de conceptos (pero las pruebas deben venir pronto despu√©s)
- Spikes t√©cnicos (pero deben descartarse o probarse despu√©s)

### Pir√°mide de Pruebas
- **Pruebas Unitarias:** Base de la pir√°mide, mayor cantidad
- **Pruebas de Integraci√≥n:** Medio de la pir√°mide, cantidad media
- **Pruebas E2E:** Parte superior de la pir√°mide, menor cantidad

### Cu√°ndo Escribir Pruebas
- **Siempre:** L√≥gica de negocio, rutas cr√≠ticas, casos l√≠mite
- **Recomendado:** Endpoints de API, funciones de utilidad
- **Opcional:** Componentes de UI simples, funciones triviales
- **IMPORTANTE:** Todos siguen TDD - prueba ANTES del c√≥digo

---

## Pruebas Unitarias

### Reglas
- Probar una cosa a la vez
- Las pruebas deben estar aisladas e independientes
- Usar nombres de prueba descriptivos
- Seguir patr√≥n AAA (Arrange, Act, Assert)

### Cobertura
- **M√≠nimo:** {{TEST_COVERAGE}}
- **Rutas cr√≠ticas:** 100% de cobertura requerida
- **L√≥gica de negocio:** 100% de cobertura requerida

{{#if TEST_TOOLS}}
### Herramientas de Prueba Utilizadas

{{TEST_TOOLS}}
{{/if}}

### Ejemplos

#### Ejemplo TDD Completo

**Paso 1: RED - Escribir prueba que falla**
```typescript
// calculateTotal.test.ts
describe('calculateTotal', () => {
  it('should return sum of all items', () => {
    // Arrange
    const items = [10, 20, 30];
    
    // Act
    const result = calculateTotal(items);
    
    // Assert
    expect(result).toBe(60);
  });
});
```
‚ùå La prueba falla porque `calculateTotal` a√∫n no existe

**Paso 2: GREEN - Implementar c√≥digo m√≠nimo**
```typescript
// calculateTotal.ts
export function calculateTotal(items: number[]): number {
  return items.reduce((sum, item) => sum + item, 0);
}
```
‚úÖ La prueba pasa

**Paso 3: REFACTOR - Mejorar si es necesario**
```typescript
// calculateTotal.ts (refactorizado si es necesario)
export function calculateTotal(items: number[]): number {
  if (items.length === 0) return 0;
  return items.reduce((sum, item) => sum + item, 0);
}
```
‚úÖ La prueba contin√∫a pasando, c√≥digo mejorado

---

## Pruebas de Integraci√≥n

### Reglas
- Probar interacciones entre componentes
- Usar base de datos de prueba (nunca producci√≥n)
- Limpiar despu√©s de las pruebas
- Mockear servicios externos

### Qu√© Probar
- Endpoints de API
- Operaciones de base de datos
- Interacciones de capa de servicio
- Flujos de autenticaci√≥n

---

## Pruebas E2E

### Reglas
- Probar viajes cr√≠ticos del usuario
- Usar entorno de navegador real
- Mantener pruebas r√°pidas y confiables
- Usar patr√≥n page object

### Qu√© Probar
- Flujos de trabajo completos del usuario
- Procesos de negocio cr√≠ticos
- Compatibilidad entre navegadores (si se requiere)

---

## Estructura de Pruebas

### Nomenclatura de Archivos
- Pruebas unitarias: `*.test.ts` o `*.spec.ts`
- Pruebas de integraci√≥n: `*.integration.test.ts`
- Pruebas E2E: `*.e2e.test.ts`

### Organizaci√≥n
- Reflejar estructura de fuente
- Agrupar pruebas relacionadas
- Usar bloques describe para organizaci√≥n

---

## Datos de Prueba

### Reglas
- Usar factories/fixtures para datos de prueba
- No usar datos de producci√≥n
- Hacer datos de prueba expl√≠citos y legibles
- Limpiar datos de prueba despu√©s de las pruebas

### Mocking
- Mockear dependencias externas
- Mockear solicitudes de red
- Mockear funciones dependientes del tiempo
- Mantener mocks simples y enfocados

---

## Integraci√≥n CI/CD

### Reglas
- Todas las pruebas deben pasar antes del merge
- Las pruebas se ejecutan en cada PR
- Las pruebas fallidas bloquean el despliegue
- Resultados de pruebas visibles en PR
- **Aplicaci√≥n de TDD:** Los PRs sin pruebas para c√≥digo nuevo ser√°n rechazados
- **Verificaci√≥n de cobertura:** La cobertura debe aumentar o mantener, nunca disminuir

---

## Patrones Prohibidos

### NO HACER
- **Escribir c√≥digo antes de las pruebas (viola TDD)**
- Saltar pruebas sin justificaci√≥n
- Escribir pruebas que dependen del orden de ejecuci√≥n
- Usar datos de producci√≥n en pruebas
- Escribir pruebas inestables
- Commitear c√≥digo sin pruebas para nuevas features
- Commitear c√≥digo que no fue desarrollado siguiendo TDD

---

## Requisitos de Cobertura

### Cobertura M√≠nima
- **General:** 70%
- **L√≥gica de Negocio:** 100%
- **Endpoints de API:** 80%
- **Utilidades:** 90%

### C√≥mo Medir
- Usar herramientas de cobertura (Jest, pytest-cov, etc.)
- Informes de cobertura en CI/CD
- Revisar cobertura en PRs

---

## Documentaci√≥n Relacionada

- **Estilo de C√≥digo:** `.cursor/rules/code-style.md`
- **Reglas de Git:** `.cursor/rules/git-rules.md`
- **Reglas de Uso de IA:** `.cursor/rules/ai-usage-rules.md`
